

<style>
	body {
		background-color: #353333;
	}
</style>

<script>

var userWeatherObj = {}

function geocodeIp(){
	var xhr = new XMLHttpRequest();

	xhr.onload = function(progressEvent){
		if(xhr.status === 200){
			var geocodeIp = JSON.parse(xhr.response);
			userWeatherObj.lat = geocodeIp.lat;
			userWeatherObj.lon = geocodeIp.lon;
			return coordsToAddress(geocodeIp);
		} else {
			console.log('There was an error ' + xhr.status);
		}
	}

	xhr.open('GET', 'http://ip-api.com/json');
	xhr.send();
}

function coordsToAddress(geocodeIp){
	var xhr = new XMLHttpRequest();

	xhr.onload = function(){
		if(xhr.status === 200){
			var userWeather = JSON.parse(xhr.response);
			return endPoint(userWeather);
		} else {
			console.log('There was an error ' + xhr.status);
		}
	}

	xhr.open('GET', `http://api.wunderground.com/api/0f1908c1667bdf37/geolookup/q/${geocodeIp.lat},${geocodeIp.lon}.json`);
	xhr.send();
}

function currentConditions(userWeather){
	var queryURL = userWeather.location.requesturl;
	queryURL = queryURL.replace(/.html/, '.json');

	var xhr = new XMLHttpRequest();

	xhr.onload = function(){
		if(xhr.status === 200){
			var result = JSON.parse(xhr.response);
			console.log(result);
		} else {
			console.log('There was an error: ' + xhr.status);
		}
	}

	xhr.open('GET', `http://api.wunderground.com/api/0f1908c1667bdf37/conditions/q/${queryURL}`);
	xhr.send();
}

function weatherCategory(weatherString){
	var regex_clear = /(clear)|(\bsunny\b)/gi,
	regex_cloudy = /(cloudy)|(mostlysunny)|(partlysunny)/gi,
	regex_fog = /(fog)|(hazy)/gi,
	regex_rain = /(chancerain)|(rain)/gi,
	regex_snow = /(flurries)|(sleet)|(snow)/gi,
	regex_tstorm = /(tstorms)/gi;

	var nightTime = /(nt_)/;

	if(regex_clear.test(weatherString)){
		userWeatherObj.weatherCategory = 'clear';
	} else if(regex_cloudy.test(weatherString)){
		userWeatherObj.weatherCategory = 'cloudy';
	} else if(regex_fog.test(weatherString)){
		userWeatherObj.weatherCategory = 'fog';
	} else if(regex_rain.test(weatherString)){
		userWeatherObj.weatherCategory = 'rain';
	} else if(regex_snow.test(weatherString)){
		userWeatherObj.weatherCategory = 'snow';
	} else if(regex_tstorm.test(weatherString)){
		userWeatherObj.weatherCategory = 'tstorm';
	}

	if(nightTime.test(weatherString)){
		userWeatherObj.nightime = true;
	} else {
		userWeatherObj.nightime = false;
	}

	return userWeatherObj;
}

geocodeIp();





</script>

